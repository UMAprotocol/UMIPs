## HEADERS
| UMIP [xx]     |                                                                                                                                  |
|------------|------------------------------------------------------------------------------------------------------------------------------------------|
| UMIP Title | Add YAM-ETH, YAM-USD, and USD-YAM as price identifiers]                                                                                                  |
| Authors    | Ross (ross@yam.finance)
| Status     | Draft                                                                                                                                  |
| Created    | January 28th, 2021                                                                            
<br>
Note that an UMIP number will be assigned by an editor. When opening a pull request to submit your UMIP, please use an abbreviated title in the filename, umip-draft_title_abbrev.md.
The title should be 44 characters or less.

<br>
<br>

# SUMMARY 

The DVM should support price requests for YAM/ETH, YAM/USD, and USD/YAM price indices.


# MOTIVATION

The DVM currently does not support the YAMETH, YAMUSD or USDYAM price indices.

Supporting the YAMUSD price identifier would enable the creation of the YAMO stablecoin, built using the OpenDAO perpetual stablecoin framework (https://opendao.gitbook.io/whitepaper-v2/) and backed by YAM as collateral. YAM token holders can utilize this as a hedging tool, and could go long or use YAMO for other financial purposes. There is also potential for the YAM DAO itself to use YAM reserves or newly minted tokens as a community backed line of credit to mint YAMO stablecoins to support its mission. 

A user would lock YAM in order to mint a new overcollateralized dollar-pegged token.  This price feed would be used to determine the liquidation price of the collateral. Since the OpenDAO framework is perpetual, the price feed would also be used to determine the funding rate and would dictate how whether there is a premium on repayment to return the YAM collateral.

Supporting the YAMETH price identifier would enable the creation of similar products that use YAM as collateral with ETH denominated as a reference price. I do not currently have an example of what these would be.

The Marketcap of YAM is currently around $38 million. While this is not a lot compared to the amount of ETH available to use to mint new synthetics, it is an untapped market that we can build around to provide additional utility to our community. 

More information on YAM can be found on the website: https://yam.finance/

<br> 

# MARKETS & DATA SOURCES

 **Required questions**

1. What markets should the price be queried from? It is recommended to have at least 3 markets.

Currently the highest volume exchange for YAM is Sushiswap (https://sushiswap.fi/pair/0x0f82e57804d0b1f6fab2370a43dcfad3c7cb239c). There is very little liquidity outside of this exchange.

2.  Which specific pairs should be queried from each market?

YAM/ETH

2. Provide recommended endpoints to query for real-time prices from each market listed. 

    - These should match the data sources used in  "Price Feed Implementation". 

    - [ADD-ENDPOINTS]
    
4. How often is the provided price updated?

    - [ANSWER]

5. Provide recommended endpoints to query for historical prices from each market listed. 

    - [ADD-ENDPOINTS]

6.  Do these sources allow for querying up to 74 hours of historical data? 

    - [ANSWER]

7.  How often is the provided price updated?

    - [ANSWER]

8. Is an API key required to query these sources? 

    - [ANSWER]

9. Is there a cost associated with usage? 

    - [ANSWER]

10. If there is a free tier available, how many queries does it allow for?

    - [ANSWER]

11.  What would be the cost of sending 15,000 queries?

     - [ANSWER]

<br>

# PRICE FEED IMPLEMENTATION

To allow for the creation of bots that can programmatically calculate prices off-chain to liquidate and dispute transactions, you must create a price feed following the UMA Protocol format (outlined below). This price feed is also necessary to calculate developer mining rewards.

To meet this criteria, please include a link to a PR to the UMA [protocol repo](https://github.com/UMAprotocol/protocol) with an example price feed that inherits this [PriceFeedInterface](https://github.com/UMAprotocol/protocol/blob/master/packages/financial-templates-lib/src/price-feed/PriceFeedInterface.js). 

Classes of price identifiers that are supported by default and require no additional price feed include.

- Any currency pair available on [Cryptowatch](https://github.com/UMAprotocol/protocol/blob/master/packages/financial-templates-lib/src/price-feed/CryptoWatchPriceFeed.js)

- [Uniswap prices](https://github.com/UMAprotocol/protocol/blob/master/packages/financial-templates-lib/src/price-feed/UniswapPriceFeed.js)

- [Balancer prices](https://github.com/UMAprotocol/protocol/blob/master/packages/financial-templates-lib/src/price-feed/BalancerPriceFeed.js)

Please provide a link to your price feed pull request.

- [ADD-LINK-TO-PULL-REQUEST]

<br>

# TECHNICAL SPECIFICATIONS

**1. Price Identifier Name** - YAM/ETH, YAM USD

**2. Base Currency** - ETH, USDC

**3. Quote currency** - YAM

- If your price identifier is a currency pair, your quote currency will be the
denominator of your currency pair. If your price identifier does not have a quote currency, please explain the reasoning behind this.

- Please be aware that the value of any UMA synthetic token is the value of the price identifier in units of the collateral currency used. If a contract’s price identifier returns 1, and is collateralized in renBTC, each synthetic will be worth 1 renBTC. In most cases, the value of your quote currency and intended collateral currency should be equal.

- [Response - if applicable]

**4. Intended Collateral Currency** - YAM

- Does the value of this collateral currency match the standalone value of the listed quote currency? 

    - YES

- Is your collateral currency already approved to be used by UMA financial contracts? If no, submit a UMIP to have the desired collateral currency approved for use. 

    - Pending UMIP

**5. Collateral Decimals** - YAM has 18 decimals (https://etherscan.io/token/0x0aacfbec6a24756c20d41914f2caba817c0d8521)


**6. Rounding** - Round to 3 decimal places. 
  

<br>

# RATIONALE

- Prices are primarily used by Priceless contracts to calculate a synthetic token’s redemptive value in case of liquidation or expiration. Contract counterparties also use the price index to ensure that sponsors are adequately collateralized. More complex computations (like incorporating additional exchanges, calculating a TWAP or VWAP, or imposing price bands, etc.) have the potential to add a greater level of precision and robustness to the definition of this identifier, particularly at settlement of each expiring synthetic token.

The addition of YAMETH, YAMUSD, and USDYAM fits into a larger goal of advancing the adoption of the UMA protocol by allowing YAM to be used as collateral for minting a stable coin among a suite of OpenDAO (https://opendao.io) stable coins. This furthers adoption of the protocol by encouraging a convergence of capital from different projects and increasing TVL.

Using the Sushiswap Price should give the most accurate price on the market as it has the deepest liquidity.

- Should the prices have any processing (e.g., TWAP)? 

<br>

# IMPLEMENTATION

**For YAM/ETH: **

1. **What prices should be queried for and from which markets?**

    - YAM/ETH Price from Sushiswap (https://sushiswap.fi/pair/0x0f82e57804d0b1f6fab2370a43dcfad3c7cb239c)

2. **Pricing interval**

    - 60 seconds

3. **Input processing**

    - None. Human intervention in extreme circumstances where the result differs from broad market consensus.

4. **Result processing** 

      - When more approved exchanges and price feeds are added, results should be calculated using the median price.

<br>

**For YAM/USD:** 

1. **What prices should be queried for and from which markets?**

    - YAM/ETH Price from Sushiswap (https://sushiswap.fi/pair/0x0f82e57804d0b1f6fab2370a43dcfad3c7cb239c)

ETH/USD Price as per UMIP-6

2. **Pricing interval**

    - 60 seconds

3. **Input processing**

    - None. Human intervention in extreme circumstances where the result differs from broad market consensus.

4. **Result processing** 

      - The YAM/ETH price should be divided by the ETH/USDC price in order to obtain the YAM/USD price. When more approved exchanges and price feeds are added for YAM, results should be calculated using the median price.

<br>

# Security considerations

Because there is only 1 liquid exchange and it is an on-chain AMM style, if liquidity is withdrawn too fast, there may be a risk in the price peg, and therefore the integrity of the system. In the current setting, there would need to be a significant event that erodes confidence in YAM and the token, causing Sushiswap liquidity to be withdrawn quickly and en-masse. This threat is mitigated via YAM incentives paid to liquidity providers who stake their tokens.

Adding this new identifier by itself poses little security risk to the DVM or priceless financial contract users. However, anyone deploying a new priceless token contract referencing this identifier should take care to parameterize the contract appropriately to the reference asset’s volatility and liquidity characteristics to avoid the loss of funds for synthetic token holders. Additionally, the contract deployer should ensure that there is a network of liquidators and disputers ready to perform the services necessary to keep the contract solvent.

$UMA-holders should evaluate the ongoing cost and benefit of supporting price requests for this identifier and also contemplate de-registering this identifier if security holes are identified. As noted above, $UMA-holders should also consider re-defining this identifier as liquidity in the underlying asset changes, or if added robustness (eg via TWAPs) are necessary to prevent market manipulation.



