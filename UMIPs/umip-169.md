## Headers

| UMIP-107                |                                                               |
| ------------------- | ------------------------------------------------------------- |
| UMIP Title          | Add `DECENTRA-LIST` as a supported price identifier |
| Authors             | pumpedlunch                                                     |
| Status              | Draft                                                         |
| Created             | January 19, 2023                                            |
| Discourse Link   |  https://discourse.umaproject.org/t/decentra-list-price-identifier/1898 |

# Summary 

The DVM should support price requests for the `DECENTRA-LIST` price identifier. The Decentra-List dapp allows users to add and remove addresses from a list based on the list creator's set of criteria. When a revision to the list is proposed, Decentra-List verifies the revision meets the list criteria by creating a price request with the `DECENTRA-LIST` price identifier and proposing the price. This UMIP includes general directions for evaluating `DECENTRA-LIST` price requests. 

Price settlement can happen in two ways:
- Return `0` if the answer is "NO" or "CAN NOT BE DETERMINED".
- Return the `1` if the answer is "YES".

# Motivation

Approving this price identifier will allow:
- Decentra-List price requests' ancillary data to be shorter with general instructions found in this price identifier UMIP rather than every request's ancillary data
- Decentra-List price requests to be easily identified from the list of oracle price requests
- Price settlement values that best meet Decentra-List's needs 

# Data Specifications 

It is not possible to define specific data sources or markets for this identifier. Determination of data sources may be defined in the List Criteria included in the ancillary data or left up to voters to determine.

# Price Feed Implementation

No price feed is needed (or possible) for this price identifier.

# Technical Specifications

-----------------------------------------
- Price identifier name: DECENTRA-LIST
- Base Currency: NA
- Quote Currency: NA
- Rounding: None, there is a predetermined set of results.
- Estimated current value of price identifier: NA


## Ancillary Data Specifications

The ancillary data for price requests from Decentra-List will be generated by smart contracts and will not allow for user input. All Decentra-List ancillary data will include:
- a question dependent on whether the proposed revision is to add or remove addresses
- the list criteria that is set by the list creator at list creation 
- the Decentra-List Revision ID number used to fund the corresponding list revision on Decentra-List

Example Ancillary Data:
`Do all Proposed Addresses meet the List Criteria at the time of the price request? List Criteria: Addresses that have voted in over 90% of UMA DVM Votes in the 365 days previous to the price request. Decentra-List Revision ID = 1.`

When this ancillary data dictionary is stored as bytes, the result would be: `0x446f20616c6c2050726f706f73656420416464726573736573206d65657420746865204c697374204372697465726961206174207468652074696d65206f662074686520707269636520726571756573743f204c6973742043726974657269613a204164647265737365732074686174206861766520766f74656420696e206f76657220393025206f6620554d412044564d20566f74657320696e207468652033363520646179732070726576696f757320746f2074686520707269636520726571756573742e20446563656e7472612d4c697374205265766973696f6e204944203d20312e20`

# Rationale

Decentra-List allows users to propose revisions to the list by proposing addresses for addition or removal from the list. The proposed revisions are then sent to the Optimistic Oracle for verification that they meet the list criteria. The price requests sent to the Optimistic Oracle only verify that the proposed revision is correct as per the list criteria. It does not verify that addresses on the list not included in the revision are correct, nor does it verify that the current revision includes all addresses that should be added or removed from the list.

It is intended that Decentra-List will only execute revisions that are provably correct as per the list criteria. As such, there are only 2 price return values provided: `1` is used for revisions that are provably "YES" and will be executed by Decentra-List and `0` is used for "NO" or "CAN NOT BE DETERMINED" and Decentra-List will reject revisions with this returned price value.

Every Decentra-List price request to the Oracle will start with a question, either "Do all Proposed Addresses meet the List Criteria?", or "Do all Proposed Addresses fail to meet the List Criteria?", depending on whether the proposed revision is to add or remove addresses to the list. These questions have been constructed so that every single address must be a "YES" for the correct Oracle response to be "YES" or `1`. For example, if a Decentra-List user proposes a revision that would add 4 addresses to the list where 3 addresses meet the criteria, but 1 address does not, the correct Oracle response would be `0` and the revision would be rejected by Decentra-List with no new addresses added to the list.

Whether an address meets a list's criteria may change over time. Proposed Addresses should be evaluated against the list criteria at the timestamp of the price request. To make this clear, the question posed in the ancillary data includes, "at the time of the price request".

# Implementation

1. Voters should decode the ancillary data to get the list criteria and the Revision ID needed to get the list of Proposed Addresses.
2. Voters should find the array of Proposed Addresses as below:
  - Navigate to the Decentra-List dapp, select the network of the price request and connect their wallet.
  - Select the List address from the drop down to display information about that List. The List address can be found in the requester field of the oracle price request.
  - Open the Pending Revisions drop down and find the Proposed Addresses for the Revision ID provided in the Oracle price request ancillary data.
3. Voters should evaluate the array of Proposed Addresses against the List Criteria provided in the ancillary data to answer the question provided in the ancillary data. The List Criteria provided in the ancillary data could contain directions on data sources, verification scripts, etc. If so, that information should be used. Otherwise, the voter should determine how to verify whether the Proposed Addresses meet the given List Criteria.
4. Voters should return `1` if the answer to the question in the ancillary data is provably "YES". Voters should return `0` if the answer to the question is "NO" or "CAN NOT BE DETERMINED".

# Security Considerations

This construction allows Decentra-List users flexibility in creating new lists with custom criteria, bond amounts and liveness periods. The list criteria will be used for all revisions to the list and can not be edited. List creators should be careful to construct the list criteria, so a deterministic outcome can be reached for all Proposed Addresses. List creators should also be careful to set the bond amount and liveness period large enough to provide disputers sufficient time and financial incentive to review all Proposed Addresses (up to 99 addresses can be included in a single revision).  

There are also potential contract-level attacks that could result from people intentionally setting up Decentra-List lists dishonestly to their advantage. As a rule, any contracts that reference a Decentra-List list smart contract, should review the list properties and this UMIP beforehand. 
