## Headers

| UMIP-112                |                                                               |
| ------------------- | ------------------------------------------------------------- |
| UMIP Title          | Add **uDAO_KPI_UMA** as a supported price identifier |
| Authors             | Brittany Madruga (brittany.madruga@gmail.com) Clayton Roche (claytonroche@gmail.com)                                                     |
| Status              | Last Call                                                         |
| Created             | 06/08/2021                                            |
| Discourse Link      | [Discourse](https://discourse.umaproject.org/t/add-uint-kpi-uma-as-a-supported-price-identifier/1181)            |

# Summary 

**The DVM should support requests for** UMA protocol DAO integrations.

Key Performance Indicator(KPI) options are synthetic tokens that redeem to protocol tokens with the redemption value determined by performance against that indicator. One example of a KPI metric is Integrations. Integrations serve to measure the activity of the protocol rather than assigning all of the value to the dollar amount generated by the protocol, as previously seen in UMA‚Äôs TVL KPI option. 

This UMIP enables the DVM to support price requests based on the number of qualifying integrations that occured during a specified timeline. This UMIP relies on the use of ancillary data, and will include a section on that below.

A synthetic option is minted against a base collateral, in this case UMA. 


# Motivation

The primary motivation for the development of KPI options is to allow protocols to incentivize DeFi users to assist them to reach the protocol's identified targets by leveraging their community resources by sharing their value with their community members.

Using DAO integrations as a key metric directly benefits the UMA protocol because it encourages the community to build relationships in the broader DeFi community with the intention of providing tools that may be useful to teams who are currently unaware of what UMA has to offer. This creates a win-win across the board because it allows us to showcase our products and our products can then help other protocols to complete their goals. 

By establishing the terms of a qualifying integration, it allows for the community to reach out in a way that aligns with the current priorities of the UMA protocol- attracting attention to our strongest products and encouraging teams to test out a wide variety of use cases.


**It is anticipated that this Price Identifier will be used to create KPI Options, however it is acknowledged that it may be used for a variety of purposes.**

# Data Specifications

The UMA team will maintain a "green light" list of qualified integrations, which will be readily available upon request. This list will include details that voters need to assess the validity of the integration (e.g. launch date of the contract so that voters can verify it is within the specified timeframe of the the current KPI option). Anyone can propose adding an integration to the list. Each integration will be added one at a time, after it has been discussed in the #voting channel in the UMA Discord. UMA tokenholders are encouraged to participate in these discussions.

An integration will have been achieved when a DAO funds with tokens one of the following three product categories:

* KPI options
* Call/Put options
* Range Bonds

**Definitions:**
*Fund* - To fund means to take the DAO‚Äôs native token or another asset from the treasury and put it into one of these above product types. The intention here is that these products will be used as a way to interact with the DAO‚Äôs community. There is an edge case here where a DAO might put money into a product with the intention to trade--This is not the spirit of this initiative and should not count towards an integration (although it is not discouraged behavior.)

*Product Categories* - The three product categories have been explored and defined in a variety of articles, and many of the articles can be seen on UMA‚Äôs medium [page](https://medium.com/uma-project). These product types would primarily be built using UMA‚Äôs LSP (Long/Short Pair) contract, and in some cases can use the EMP contract. However, it is important to note that they will all be fully capitalized products, without any chance or need for liquidations.
Only one integration per product type per DAO can qualify. This means that the maximum number of integrations available to a single DAO would be 3. It is perhaps possible to imagine a DAO that has subsidiaries or close partnerships with other DAOs, such that it is not clear to which DAO a product integration would apply. In this case, the authors suggest deferring to the ambiguity consideration section below. 

*DAO* - A decentralized, autonomous organization. We would expect them to have a native token (although this is not a requirement) and a governance system. There are perhaps DAOs that are not yet very decentralized--they should be included all the same. However, the spirit of this design is that it incentivizes DAO-to-DAO activity in a way that engages the core team and community for both DAOs, and so we would expect that to represent the lionshare of activity. If there is a non-DAO integration that is judged to be especially valuable, it is up to the discretion of Risk Labs to offer additional uDAO tokens as a reward. 

**Ambiguity Considerations**

With regard to the definition of a DAO, this is perhaps the definition in the list with the most leeway. It is easy to know a good DAO when you see it, but it is possible to imagine ‚Äúbad DAOs.‚Äù For example, consider a DAO that was created for the express purpose of increasing integrations. The authors here suggest using the inclusion criteria that borrows from that of trusted information sources in the space. To codify this, a DAO must be included somewhere on one of these lists:

* CoinGecko - Their product token must be listed here
* DeFi Pulse - If they are listed on DeFi Pulse, they quality as a DAO

There is one type that this misses: new projects with illiquid tokens. We wouldn‚Äôt want to exclude this valuable integration type from inclusion in the KPI Options. This is a category that we will leave to UMA tokenholders to evaluate. As a guiding principle, a qualifying DAO is part of a good faith project; a disqualifying DAO would be one with no genuine attempt at a company or organization. Any ambiguities around the question of, "is it a DAO?" will be discussed in the #voting channel on the UMA Discord. It is especially important to the design of this UMIP that UMA tokenholders participate in these discussions to establish borad consensus on questions that don't have black and white answers. 

**Bonus Integrations**

As seen below in the ancillary data section, this UMIP allows for the deployer of the contract to include bonus parameters for integrations above a set TVL threshold, denominated in $USD. If a deployer elects to include a bonus option, they should specify the minimum value required to qualify, the max number of integrations that can qualify for a bonus, and the multiplier to be applied to these integrations. To be consistent throught this UMIP, an integration will qualify for a bonus if it reaches the TVL threshold at any point in the life of the kpi option. If an integration qualifies for the specified bonus, it will be indicated on the "green light" list with a üêã. 

It is assumed that the collateral token in most cases will not be USD. Rather than requiring contract deployers to supply a price feed for determining the collateral token value in USD, this should be a component of discussion in the evaluation process that occurrs in the #voting channel in UMA Discord. As a reminder, anyone can propose that something be included on the "green light" list. If someone believes that an integration has qualified for a bonus, they should provide a detailed explanation of their proposal to be discussed in the #voting channel in the UMA Discord. 

**Additional Notes:** 

LSP contracts deployed by UMA for use by UMA do not count, but if UMA deploys a contract for use by another team, it is eligible as long as it meets the criteria above.

Contracts included are not limited to Ethereum mainnet- contracts on other chains where DVM message bridging is available (e.g. Polygon) will be included in consideration.

The applied timeframe for this UMIP will be specified in ancillary data, and all qualifying integrations launched during this timeframe should be counted. 

The "green light" list should not be considered the *only* source of truth, but rather a reflection of the discussions that take place within the community. The DVM has the ability and responsibility to challenge the validity of any integrations that have been included or excluded from the list if the broader consensus of UMA tokenholders is that it is within the spirit of this UMIP to do so. Any and all questions surrounding the validity of an integration can be brought up in further detail in the #voting channel on the UMA Discord.

# Ancillary Data Specifications
The following pieces of data will be included as ancillary data when the contract is deployed, and will provide additional details & instructions to help voters correctly identify the number of qualifying integrations.

* `startTimestamp` (unix timestamp)
* `maxBaseIntegrations` (non-negative integer)
* `maxBonusIntegrations` (non-negative integer)
* `bonusMinValue` (TVL threshold for bonus integrations represented in $USD)
* `bonusIntegrationsMultiplier` (non-negative number rounded to 2 decimals)
* `floorIntegrations` (non-negative integer)

Ancillary data should be passed into the contract using the format in the example below.
```
startTimestamp:1622527200, maxBaseIntegrations:15, maxBonusIntegrations:3, bonusMinValue:$1,000,000, bonusIntegrationsMultiplier:3.00, floorIntegrations:3
```

If a contract deployer incorrectly formats or simply does not provide one of the parameters above, it will default to the following values. This means that if no ancillary data is present, the value returned should be 0.

* `startTimestamp` (timestamp of contract deployment)
* `maxBaseIntegrations` (0)
* `maxBonusIntegrations` (0)
* `bonusMinValue` ($0)
* `bonusIntegrationsMultiplier` (0.00)
* `floorIntegrations` (0)

# Technical Specifications

- **Price identifier name:**  *uDAO_KPI_UMA*
- **Base: Number of qualified DAO integrations
- **There is no quote currency in this option, as design feature. The collateral redemption is tied to the** *number of qualified integrations* **by design**
 - **Intended Collateral Currency** *UMA*.
- **Rounding:** *Round to 2 decimals* 
 

# Rationale

* Linear scaling is used for sake of ease for contract deployment and for voters. Integrations that qualify for a bonus will simply be treated as multiple integrations as a way to recognize the increased value and work needed to get them across the finish line.

* Allowing for a specified minimum payout is intented to account for the integrations that occurred prior to launch, in an effort to reward the community for hard work leading up to the launch of this KPI option.

* Minimum payout may be established in ancillary data via the `floorIntegrations` parameter, or it can be baked into the contract. This is a design decision to be made by the contract deployer. If it is baked into the contract, details can be customized using the [financial-products-library](https://github.com/UMAprotocol/protocol/tree/master/packages/core/contracts/financial-templates/common/financial-product-libraries/long-short-pair-libraries). Allowing variations of this feature as a design choice allows deployers to weigh the pros and cons of exchainging simplisity for transparancy. In both cases, more details on minimum payout and scaling can be found within the deployed contract. 

* The decision to stick to the listed product types was made in order to focus the community and align incentives with the strategic goals of the organization.

* Setting it up to allow for all qualified launches to be counted throughout the period rather than just at the time of expiry helps to ensure that we are not missing out on any integrations that might expire before the KPI option does. The same logic is applied to bonus qualifying integrations.

* Having a customized starting timestamp allows a contract deployer to include integrations that occur prior to launch of this option. This design feature can act to reward the community for prior work done and may also help keep momentum going while the current KPI expires. 

* The rationale for choosing DAO integrations was to emphasize building DAO-to-DAO relationships. UMA‚Äôs product suite has increasingly gained focus and traction on DAO treasury management. However, it is not scalable for the development team to focus on promotion and integration efforts alone, and this KPI Option has been designed to help recruit the community to help.


# Implementation

Step 1: Refer to "green light" list for finalized information on all qualified integrations. Assign 1 point for each integration on the list, including any integrations that have qualified for a bonus. 

Step 2: If an integration qualifies for a bonus, it will be indicated with a üêã. These integrations are worth some multiplier of points *in addition* to the base points counted above. This multiplier will be specified in the ancillary data as `bonusIntegrationsMultiplier`. Keep track of bonus points and base points separately.  

* Note for step 2: In order for an integration to earn a üêã marker, it must meet the minimum TVL threshold as defined in the ancilary data parameter `minBonusValue`. This value is denominated in $USD rather than the collateral token, so discussion of $USD value had to take place in the #voting channel in UMA Discord in order for an integration to earn this status. For additional details on bonuses, see the above section on bonus integrations.

Step 3: Tally up the total number of base points as well as the number of bonus points. At this point, the two numbers should be separate.

Step 4: Using the ancillary data specifications for `maxBaseIntegrations` and `maxBonusIntegrations`, decide if your tally exceeds the max allowed for either category. If the value of your tally exceeds the max allowable points in either category, use the value provided by `maxBaseIntegrations` and `maxBonusIntegrations`.

Step 5: Add base points plus bonus points from the step above for the total number of points. This is the value you will return. If the value returned would be lower than `floorIntegrations`, use the value provided by this field in ancillary data.


# Security Considerations

Due to the bespoke nature of this UMIP, it should not be considered a standard against which futuer UMIPs can me measured without considering the amount of risk in establishing a set of rules as qualitative as is the case here. When assessing the risk of using qualitative data to determine an outcome, several things have been considered, such as the intended "in house" use of this UMIP, the intended recipients of the uDAO token, the intended outcome of the KPI option, and how to handle any ambiguities that could arise over the course of this option. 

How could metric manipulation occur?

* By establishing a discussion system for determining qualitative validity of an integration, it reduces the ability of any individual to game the system. The DVM voters have the ability to determine if it appears that someone is acting maliciously and can disqualify any integrations that majority believe should not be included.

How could this price ID be exploited?

* The definition of the metric is inherently qualitative, and utilizes a logic that requires an integration to "earn" its way onto a curated list. This factor, which relies on human judgement, makes it inprobable that it will be exploited.

Do the instructions for determining the price provide people with enough certainty?

* Yes. Voters need only return the number of qualified integrations at the time of expiry.
	
Are there any current or future possible concerns with the way the price identifier is defined?

* It could be determined that the scaling is not appropriate in the event of overwhelming failure of the option. This would happen if we achieved too few integrations or if we reach the goal too quickly.
* Additionally, there is the potential for ambiguities to present that have not been considered at the time of writing. In this case it will be up to the DVM to determine the resolution of those ambiguities. 
* It is possible that over the course of the KPI option, UMA could determine there are other products they would like to prioritize that are not defined in this UMIP. In that case, another KPI option can be launched to include that product.

Are there any concerns around if the price identifier implementation is deterministic?

* No
